<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Тест (Руководитель): Расхождения при приеме товара (1С)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.35; }
    .card { max-width: 980px; margin: 0 auto; border: 1px solid #ddd; border-radius: 12px; padding: 18px; }
    h1 { font-size: 20px; margin: 0 0 10px; }
    .meta { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0 18px; }
    input, select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; }
    .q { padding: 14px 0; border-top: 1px solid #eee; }
    .q:first-of-type { border-top: none; }
    .q-title { font-weight: 700; margin: 0 0 10px; }
    .opt { display: block; padding: 8px 10px; border: 1px solid #eee; border-radius: 10px; margin: 8px 0; cursor: pointer; }
    .opt:hover { background: #fafafa; }
    .actions { display:flex; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; background: white; cursor: pointer; }
    button.primary { background: #111; color: #fff; border-color: #111; }
    .status { margin-top: 12px; font-size: 14px; }
    .muted { color:#666; }
    .hidden { display:none; }
    .result { padding: 12px; border-radius: 12px; background:#f7f7f7; margin-top: 14px; }
    .badge { display:inline-block; padding: 2px 8px; border-radius: 999px; background:#eee; font-size: 12px; margin-left: 8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Тест (Руководитель) <span class="badge">25 вопросов</span></h1>
    <div class="muted">Ответьте на все вопросы и нажмите «Отправить результат». Итоги сохраняются в таблицу.</div>

    <div class="meta">
      <div>
        <label>ФИО</label>
        <input id="name" placeholder="Например: Иванов Иван" />
      </div>
      <div>
        <label>Роль</label>
        <select id="role">
          <option value="">Выберите…</option>
          <option>Руководитель / старший смены</option>
        </select>
      </div>
    </div>

    <div id="quiz"></div>

    <div class="actions">
      <button id="btnCheck">Проверить (локально)</button>
      <button class="primary" id="btnSubmit">Отправить результат</button>
      <button id="btnReset">Сбросить</button>
    </div>

    <div class="status" id="status"></div>
    <div class="result hidden" id="resultBox"></div>
  </div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbziYMZkxWnhZiAiHkPr4-TidgzpyR0y5V9ToVXus-CnQfSD_qKGXWCHGDHRK55Fyl-W/exec";
  const TEST_TYPE = "MANAGER";

  const QUESTIONS = [
    { id: 1, text: "Какой корректный путь в 1С к обработке расхождений?",
      options: [
        "Склад и логистика → Листы разногласий → Обработка расхождений при приеме товара",
        "Продажи → Возвраты → Обработка расхождений",
        "Финансы → Инвентаризация → Расхождения",
        "Закупки → Поставщики → Разногласия"
      ], correct: 0
    },
    { id: 2, text: "Какие поля критичны для отбора перед формированием списка?",
      options: [
        "Отправитель и Получатели",
        "Касса и Смена",
        "Цена и Скидка",
        "Поставщик и Договор"
      ], correct: 0
    },
    { id: 3, text: "Что означает «Заявлено» (красное с минусом)?",
      options: [
        "Недоезд: не дождались указанного количества",
        "Переизбыток",
        "Брак",
        "Уценка"
      ], correct: 0
    },
    { id: 4, text: "Что означает «Заявлено» (синее значение)?",
      options: [
        "Лишний товар (переизбыток)",
        "Недоезд",
        "Резерв",
        "Продажа"
      ], correct: 0
    },
    { id: 5, text: "Кейс: у филиала А недоезд -2 по товару X, у филиала B лишний +2 по тому же товару X. Какая причина корректнее?",
      options: [
        "Выгружен на другом филиале",
        "Микс",
        "Лишний товар",
        "Не погружен на отправителе"
      ], correct: 0
    },
    { id: 6, text: "При «Выгружен на другом филиале» какое действие обязательное?",
      options: [
        "Выбрать подтверждающий документ по связанному листу разногласий",
        "Поставить только комментарий",
        "Сделать уценку",
        "Создать чек продажи"
      ], correct: 0
    },
    { id: 7, text: "Почему система может запретить подтверждение «Выгружен на другом филиале»?",
      options: [
        "Не выбраны все подтверждающие документы и/или количества не сходятся (в сумме не 0)",
        "Не заполнено поле ФИО",
        "Нет остатка у получателя",
        "Неверный часовой пояс"
      ], correct: 0
    },
    { id: 8, text: "Какие причины обычно НЕ требуют подтверждающий документ?",
      options: [
        "Микс / Не погружен на отправителе / Вернулся отправителю / Лишний товар",
        "Только «Выгружен на другом филиале»",
        "Любые причины всегда требуют подтверждающий документ",
        "Только «Недоезд»"
      ], correct: 0
    },
    { id: 9, text: "Что создается автоматически при подтверждении причин (микс/не погружен/вернулся/лишний)?",
      options: [
        "Документ «Инвентаризация» (и подтверждение листа разногласий)",
        "Заявка на закупку",
        "Перемещение между складами",
        "Списание уценки"
      ], correct: 0
    },
    { id: 10, text: "Почему отмена/удаление «Инвентаризации» может быть ограничена и что делать при необходимости отмены?",
      options: [
        "Документ влияет на учет/обмен; действовать через инцидент в поддержку",
        "Можно удалить всегда без последствий",
        "Нужно перезайти в 1С",
        "Достаточно очистить кэш"
      ], correct: 0
    },
    { id: 11, text: "Кейс: лист разногласий создан ошибочно, расхождения нет. Как закрыть корректно?",
      options: [
        "Создать сторнирование на основании «Разногласие» (делает инициатор)",
        "Списать товар уценкой",
        "Создать продажу на 1 рубль",
        "Удалить документ вручную"
      ], correct: 0
    },
    { id: 12, text: "Что должно быть заполнено перед «Подтвердить отмеченные»?",
      options: [
        "Подтверждено и Причина (и подтверждающий документ — если требуется)",
        "Только Остаток",
        "Только Комментарий",
        "Только Отправитель"
      ], correct: 0
    },
    { id: 13, text: "Зачем руководителю контролировать поле «Подтверждено»?",
      options: [
        "Это влияет на закрытие расхождения и корректность учета",
        "Поле справочное и не влияет",
        "Поле только для печати",
        "Поле для скидок"
      ], correct: 0
    },
    { id: 14, text: "Как выбирается «Причина» в 1С?",
      options: [
        "Двойной клик → выбор из списка",
        "Только через администратора",
        "Всегда автоматически",
        "Через письмо в бухгалтерию"
      ], correct: 0
    },
    { id: 15, text: "Что означает «Остаток» и зачем его смотреть?",
      options: [
        "Учетный остаток у отправителя; помогает выявлять системные ошибки отгрузки",
        "Остаток времени смены",
        "Остаток бюджета",
        "Остаток скидок"
      ], correct: 0
    },
    { id: 16, text: "Кейс: по товару «Заявлено» +1 (лишний). Какое базовое действие корректно?",
      options: [
        "Выбрать причину (например «Лишний товар») и подтвердить количество",
        "Списать товар без документов",
        "Поставить 0 и закрыть",
        "Сделать возврат покупателя"
      ], correct: 0
    },
    { id: 17, text: "Что закрывает лист разногласий при подтверждении?",
      options: [
        "Создание документа с операцией «Подтверждение»",
        "Выход из 1С",
        "Z-отчет кассы",
        "Подтверждение поставщика"
      ], correct: 0
    },
    { id: 18, text: "Что правильно писать в «Комментарий подтверждающего»?",
      options: [
        "Коротко: причина, действие, ссылка/номер связанного документа если нужно",
        "Смайлики",
        "Только дату",
        "Ничего"
      ], correct: 0
    },
    { id: 19, text: "Кейс: количества по связанным листам не сходятся. Что делать?",
      options: [
        "Исправить подтверждено/связки документов до баланса",
        "Подтвердить как есть",
        "Удалить один документ",
        "Списать разницу уценкой"
      ], correct: 0
    },
    { id: 20, text: "Зачем руководителю читать «Комментарий заявителя»?",
      options: [
        "Чтобы понять контекст и выбрать верные действия/причину",
        "Это неважное поле",
        "Там рекламный текст",
        "Это лог кассы"
      ], correct: 0
    },
    { id: 21, text: "Риск неверных причин ради «скорости закрытия» — это…",
      options
